/*
	Copyright 2025-9999 sub1to

	This file is part of PHook

	PHook is free software; See LICENSE.MD or https://opensource.org/license/mit
*/

#ifndef _PHOOK_H
#define _PHOOK_H

#include "phook.h"
#include "hook.h"
#include <map>

#define get_array_size(array)	(sizeof(array) / sizeof(array[0]))

#define ALLOC_MAX_DELTA		0x70000000u
#define	ALLOC_BLOCK_SIZE	65536u - 1u	//65536u
#define PHOOK_SPINCOUNT		0x10u

namespace _phook
{
	typedef std::map<void*,IPHook*>		hookMap;

	extern hookMap*		m_hookMap;

	//////////////////////////////////////////////////////////////////////////////////////////// PUBLIC FUNCTIONS /////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////// PUBLIC FUNCTIONS /////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////// PUBLIC FUNCTIONS /////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////// PUBLIC FUNCTIONS /////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////// PUBLIC FUNCTIONS /////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////// PUBLIC FUNCTIONS /////////////////////////////////////////////////////////////////////////////////////////////////

	PHRET	initialize(HMODULE hModule, uint64_t flags);
	PHRET	uninitialize();
	PHRET	create_hook(void* pTarget, void* pHook, void** ppTrampoline, size_t ullHookSize, PHTYPE type);
	PHRET	destroy_hook();
	PHRET	destroy_hook(void* pTarget);
	PHRET	hook(void* pTarget);
	PHRET	hook(vec_pvoid targets);
	PHRET	unhook();
	PHRET	unhook(void* pTarget);
	PHRET	unhook(vec_pvoid targets);
	PHRET	is_hooked(void* pTarget);
	vec_mem	mem_blocks();
	bool	resolve_rel(void* pRel, size_t size, void* pStart, void* pEnd);
};

#endif //_PHOOK_H